<!DOCTYPE html>
<html lang="en">

<head>
  <title>min-translator</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
  <h1>Hello</h1>
  <p id="text">The Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75thThe Boat Race 2021 comprised two side-by-side rowing races that took place on 4 April. The Boat Race is
    contested
    annually between crews from the universities of Oxford and Cambridge. Traditionally held on the Championship Course
    in London, the 2021 race instead took place on the River Great Ouse near Ely (course map pictured). This was the
    75th</p>
  <style>
    body {
      background-color: white;
    }
  </style>
</body>

<script type="module">
  import {initializeApp} from "https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js"
  import {getAnalytics} from "https://www.gstatic.com/firebasejs/9.6.7/firebase-analytics.js"
  import {getDatabase, ref, update} from "https://www.gstatic.com/firebasejs/9.6.7/firebase-database.js"
  import {getAuth, signInWithEmailAndPassword} from "https://www.gstatic.com/firebasejs/9.6.7/firebase-auth.js"

  // translator config
  const config = {
    key: "?",                                                                 // key name
    additionalKey: "shiftKey",                                                // shiftKey | altKey | ctrlKey
    fbEmail: "xxxxxxxxxxxxxxxxxxx",                                           // translator service email
    fbPassword: "xxxxxxxx",                                                   // translator service password
    NLPKey: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",             // NLP api key (https://rapidapi.com/gofitech/api/nlp-translation/)
    from: "en",                                                               // from language
    to: "ja",                                                                 // to language
    tooltipsId: "qsaPer12dcksx9zd9",                                          // tooltips tag id
  }

  // firebase config
  const firebaseConfig = {};

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth();
  const db = getDatabase(app);
  let uid = null;
  let hasTranslatedLabels = false;  // flag

  signInWithEmailAndPassword(auth, config.fbEmail, config.fbPassword)
    .then((userCredential) => {
      uid = userCredential.user.uid;
    })
    .catch(console.error);

  const addToDictionary = async ($tooltip, original, translated) => {
    if (uid) {
      try {
        update(ref(db, `users/${uid}`), {
          [original]: translated
        });
        $tooltip.innerHTML = "Success"
      } catch (e) {
        $tooltip.innerHTML = e.message
      }
    } else {
      $tooltip.innerHTML = "You are not autorized"
    }
  };

  // config defined key down handler
  document.onkeydown = e => {
    if (hasTranslatedLabels) {
      document.querySelectorAll(`#${config.tooltipsId}`).forEach(element => element.remove())
      hasTranslatedLabels = false
    }

    if (!e[config.additionalKey] || e.key !== config["key"]) return;
    const selected = document.getSelection();
    if (!selected.toString().length) return;

    e.preventDefault();
    const selectedText = selected.toString().trim()
    if (selectedText) fetch(`https://nlp-translation.p.rapidapi.com/v1/translate?text=${selectedText}&to=${config.to}&from=${config.from}`, {
      "method": "GET",
      "headers": {
        "x-rapidapi-host": "nlp-translation.p.rapidapi.com",
        "x-rapidapi-key": config.NLPKey
      }
    })
      .then(response => response.json()).then(result => {
        const range = selected.getRangeAt(0);
        const rect = range.getBoundingClientRect();
        const tooltip = document.createElement("span");
        hasTranslatedLabels = true;
        tooltip.id = config.tooltipsId;
        tooltip.onclick = () => addToDictionary(tooltip, selectedText, result.translated_text[config.to])
        tooltip.innerHTML = `<svg style="height: 18px; width: 18px; fill: #9fa0a3; cursor: pointer" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-square-plus" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2" /><line x1="9" y1="12" x2="15" y2="12" /><line x1="12" y1="9" x2="12" y2="15" /></svg>${result.translated_text[config.to]}`;
        tooltip.style = `top: ${rect.y + (rect.bottom - rect.y) + window.pageYOffset}px; left: ${rect.x + window.pageXOffset - 30}px; position: absolute; background-color: #282c34; color: #9fa0a3; padding: 5px; font-weight: 500; display: flex; gap: 5px; align-items: center; font-family: Arial; cursor: pointer;`
        document.body.append(tooltip)
      })
      .catch(err => {
        console.error(err);
      });
  }
</script>

</html>
